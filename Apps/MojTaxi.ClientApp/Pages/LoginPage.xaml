<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="MojTaxi.ClientApp.Pages.LoginPage"
    BackgroundColor="Black"
    Shell.NavBarIsVisible="False">

    <ScrollView BackgroundColor="#000000">
        <VerticalStackLayout
            Padding="24"
            Spacing="18"
            BackgroundColor="#000000"
            VerticalOptions="Center"
            HorizontalOptions="Fill"
            MaximumWidthRequest="500">

            <Image Source="logo.png"
                   HeightRequest="120"
                   HorizontalOptions="Center"/>

            <!-- LOGIN MODE -->
            <Border BackgroundColor="#1A1A1A"
                    StrokeShape="RoundRectangle 14"
                    Padding="3"
                    HeightRequest="50">

                <Grid ColumnDefinitions="*,*">

                    <!-- SMS -->
                    <Border Grid.Column="0"
                            StrokeShape="RoundRectangle 12"
                            BackgroundColor="Transparent">
                        <Border.Triggers>
                            <DataTrigger TargetType="Border"
                                         Binding="{Binding IsSms}"
                                         Value="True">
                                <Setter Property="BackgroundColor" Value="#FEF000"/>
                            </DataTrigger>
                        </Border.Triggers>

                        <Button Text="SMS"
                                Command="{Binding SetSmsCommand}"
                                BackgroundColor="Transparent"
                                FontAttributes="Bold"
                                TextColor="White">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button"
                                             Binding="{Binding IsSms}"
                                             Value="True">
                                    <Setter Property="TextColor" Value="Black"/>
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </Border>

                    <!-- EMAIL -->
                    <Border Grid.Column="1"
                            StrokeShape="RoundRectangle 12"
                            BackgroundColor="Transparent">
                        <Border.Triggers>
                            <DataTrigger TargetType="Border"
                                         Binding="{Binding IsEmail}"
                                         Value="True">
                                <Setter Property="BackgroundColor" Value="#FEF000"/>
                            </DataTrigger>
                        </Border.Triggers>

                        <Button Text="Email"
                                Command="{Binding SetEmailCommand}"
                                BackgroundColor="Transparent"
                                FontAttributes="Bold"
                                TextColor="White">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button"
                                             Binding="{Binding IsEmail}"
                                             Value="True">
                                    <Setter Property="TextColor" Value="Black"/>
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </Border>

                </Grid>
            </Border>

            <!-- INPUTS CONTAINER (fiksna visina da se logo ne pomjera) -->
            <!-- Podesi HeightRequest po potrebi (npr. 140/150) -->
            <Grid HeightRequest="140">
                <!-- SMS -->
                <VerticalStackLayout IsVisible="{Binding IsSms}"
                                     VerticalOptions="Center"
                                     Spacing="12">
                    <Picker Title="Odaberi državu"
                            ItemsSource="{Binding Countries}"
                            SelectedItem="{Binding SelectedCountry}"
                            ItemDisplayBinding="{Binding DisplayName}"
                            BackgroundColor="#1A1A1A"
                            TextColor="White"/>

                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                        <Entry Text="{Binding SelectedCountry.Code}"
                               IsEnabled="False"
                               WidthRequest="80"
                               BackgroundColor="#1A1A1A"
                               TextColor="White"
                               HorizontalTextAlignment="Center"/>

                        <Entry Grid.Column="1"
                               Placeholder="Broj telefona"
                               Text="{Binding PhoneNumber}"
                               Keyboard="Telephone"
                               BackgroundColor="#1A1A1A"
                               TextColor="White"/>
                    </Grid>
                </VerticalStackLayout>

                <!-- EMAIL -->
                <VerticalStackLayout IsVisible="{Binding IsEmail}"
                                     VerticalOptions="Center">
                    <Entry Placeholder="Email adresa"
                           Text="{Binding Email}"
                           Keyboard="Email"
                           BackgroundColor="#1A1A1A"
                           TextColor="White"/>
                </VerticalStackLayout>
            </Grid>

            <Button Text="Pošalji OTP"
                    Command="{Binding SendOtpCommand}"
                    Style="{StaticResource TaxiButton}" />

            <!-- OTP -->
            <VerticalStackLayout IsVisible="{Binding OtpSent}">
                <Entry x:Name="OtpEntry"
                       Placeholder="OTP kod"
                       Text="{Binding OtpCode}"
                       Keyboard="Numeric"
                       BackgroundColor="#1A1A1A"
                       TextColor="White"
                       HorizontalTextAlignment="Center"/>

                <Button Text="Potvrdi i prijavi se"
                        Command="{Binding VerifyOtpCommand}"
                        IsEnabled="{Binding CanVerifyOtp}"
                        Style="{StaticResource TaxiButton}" />

                <Button Text="{Binding OtpCooldown, StringFormat='Pošalji ponovo za {0}s'}"
                        Command="{Binding SendOtpCommand}"
                        IsEnabled="{Binding CanResendOtp}"
                        BackgroundColor="Transparent"
                        TextColor="#FEF000"/>
            </VerticalStackLayout>

            <Label Text="{Binding Error}"
                   TextColor="Red"
                   HorizontalOptions="Center"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
